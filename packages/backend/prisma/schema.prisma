generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model UserSpaceData {
  id         Int      @id @default(autoincrement())
  mid        Int      @unique
  name       String
  sex        String
  level      Int
  face       String
  sign       String
  userStatus Json
  following  Int
  follower   Int
  createdAt  DateTime @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime @updatedAt @db.Timestamptz(6)
}

model CronTrigger {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  taskName    String
  cron        String
  params      Json?
  enabled     Boolean  @default(true)
  description String?
  source      String   @default("database")
  createdAt   DateTime @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime @updatedAt @db.Timestamptz(6)

  @@index([taskName])
  @@index([enabled])
  @@index([source])
}

model TaskExecution {
  id            String    @id @default(uuid())
  taskName      String
  triggerSource String
  triggerName   String?
  params        Json?
  status        String
  result        Json?
  error         String?
  retryCount    Int       @default(0)
  maxRetries    Int       @default(0)
  startedAt     DateTime  @db.Timestamptz(6)
  finishedAt    DateTime? @db.Timestamptz(6)
  duration      Int?
  createdAt     DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime  @updatedAt @db.Timestamptz(6)

  @@index([taskName])
  @@index([status])
  @@index([triggerSource])
  @@index([startedAt])
  @@index([createdAt])
}
