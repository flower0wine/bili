generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model UserSpaceData {
  id              Int      @id @default(autoincrement())
  mid             Int
  name            String
  sex             String
  face            String
  faceNft         Int      @default(0)
  sign            String   @db.Text
  level           Int
  birthday        String?  // MM-DD格式
  
  // 认证与会员信息
  official        Json?    // 认证信息
  vip             Json?    // 会员信息
  pendant         Json?    // 头像框信息
  nameplate       Json?    // 勋章信息
  
  // 社交信息
  fansBadge       Boolean  @default(false)
  fansMedal       Json?    // 粉丝勋章信息
  isFollowed      Boolean  @default(false)
  topPhoto        String?  // 主页头图链接
  
  // 其他展示信息
  liveRoom        Json?    // 直播间信息
  tags            Json?    // 个人标签数组
  sysNotice       Json?    // 系统通知
  isSeniorMember  Int      @default(0)
  
  createdAt       DateTime @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime @updatedAt @db.Timestamptz(6)

  @@index([mid])
  @@index([createdAt])
}

model CronTrigger {
  id          String   @id
  name        String   @unique
  taskName    String
  cron        String
  params      Json?
  enabled     Boolean  @default(true)
  description String?
  source      String   @default("database")
  createdAt   DateTime @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  @@index([taskName])
  @@index([enabled])
  @@index([source])
}

model UserCard {
  id              Int      @id @default(autoincrement())
  mid             Int
  name            String
  sex             String
  face            String
  sign            String   @db.Text
  level           Int
  
  // 统计信息
  fans            Int      // 粉丝数
  friend          Int      // 关注数
  archiveCount    Int      // 稿件数
  articleCount    Int      // 专栏数
  likeNum         Int      // 点赞数
  
  // 认证与会员信息
  official        Json?    // 认证信息
  vip             Json?    // 会员信息
  pendant         Json?    // 头像框信息
  nameplate       Json?    // 勋章信息
  
  // 社交信息
  following       Boolean  @default(false) // 是否关注此用户
  space           Json?    // 主页头图信息
  
  createdAt       DateTime @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime @updatedAt @db.Timestamptz(6)

  @@index([mid])
  @@index([createdAt])
}

model TaskExecution {
  id            String    @id @default(uuid())
  taskName      String
  triggerSource String
  triggerName   String?
  params        Json?
  status        String    // running, success, failed, cancelled
  result        Json?
  error         String?   @db.Text
  retryCount    Int       @default(0)
  maxRetries    Int       @default(0)
  startedAt     DateTime  @db.Timestamptz(6)
  finishedAt    DateTime? @db.Timestamptz(6)
  duration      Int?
  createdAt     DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime  @updatedAt @db.Timestamptz(6)

  @@index([taskName])
  @@index([status])
  @@index([triggerSource])
  @@index([startedAt])
  @@index([createdAt])
}
